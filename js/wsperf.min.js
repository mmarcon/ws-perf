window.addEventListener("load",function(){setTimeout(function(){window.scrollTo(0,1)},0)});
(function(f){var d=f.WSPERF={},g;g=function(a,b){var c;c=document;g.emptyElement=c.createElement("div");b?c=c.querySelectorAll(a):(c=c.querySelector(a),c||(c=g.emptyElement));return c};d.BrowserDetect={init:function(){this.browser=this.searchString(this.dataBrowser)||"An unknown browser";this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"an unknown version";this.OS=this.searchString(this.dataOS)||"an unknown OS"},searchString:function(a){for(var b=0;b<
a.length;b++){var c=a[b].string,d=a[b].prop;this.versionSearchString=a[b].versionSearch||a[b].identity;if(c){if(-1!=c.indexOf(a[b].subString))return a[b].identity}else if(d)return a[b].identity}},searchVersion:function(a){var b=a.indexOf(this.versionSearchString);if(-1!=b)return parseFloat(a.substring(b+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},
{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:f.opera,identity:"Opera",versionSearch:"Version"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",
identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],dataOS:[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:navigator.platform,subString:"iPad",identity:"iPad"},{string:navigator.platform,
subString:"iPhone",identity:"iPhone"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]};d.progress=function(a){var b=d.progress.node||g(".test-progress"),c=document.createElement("p");c.innerHTML=a;b.appendChild(c)};d.Controller=function(){var a="/",b=[],c,d=function(){};c=function(c){var a,h,i=!1;for(a=0;a<b.length;a++)if(h=c.match(b[a].matcher))h.shift(),b[a].callback.apply(null,[c,h]),i=!0;i||d.apply(null,[c])};return{open:function(b){a=b.replace(/^#/,"");c(a)},subscribe:function(c,
a,h){"function"===typeof a&&(b.push({matcher:c,callback:a}),h&&(d=a))},reset:function(){a="/";b.length=0},subscribers:function(){return b.length}}}();d.Templater=function(){var a={};(function(){var b=g(".template",!0);Array.prototype.forEach.call(b,function(b){a[b.id]={content:b.innerHTML,destination:b.dataset.destination}})})();return{use:function(b,c,d){b=a[b];"function"===typeof c&&(d=c,c=null);c=c||{};b&&(c=f.tmpl(b.content,c),b=document.querySelector(b.destination),b.innerHTML=c,"function"===
typeof d&&d.call(null,null))}}}();d.TestSuite=function(){var a=[],b,c,e={};b=function(b){var a="",c,d,b=b||1024;for(c=0;c<b;c++)d=Math.floor(61*Math.random()),a+="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz".substring(d,d+1);return a};c=function(b){this.end=this.start=-1;this.close=this.errors=0;this.done=!1;this.payload=b;this.info={}};c.prototype.run=function(b){var a,c=this;a="Safari"===d.BrowserDetect.browser?new WebSocket("ws://"+f.location.host):new WebSocket("wss://"+f.location.host);
a.onopen=function(){c.start=Date.now();a.send(c.payload)};a.onmessage=function(){c.end=Date.now();c.done=!0;setTimeout(function(){a.close()},1E3);"function"===typeof b&&b.call(c,c.getStats())};a.onclose=function(a,d){c.end=Date.now();c.close+=1;c.info.close=[a,d];"function"===typeof b&&!1===c.done&&b.call(c,c.getStats())};a.onerror=function(){c.end=Date.now();c.error+=1;"function"===typeof b&&b.call(c,c.getStats())}};c.prototype.runXHR=function(c){var b,a=this;b=new XMLHttpRequest;b.open("POST","/helper/xhr");
b.setRequestHeader("Content-Type","application/json");b.onloadstart=function(){a.start=Date.now()};b.onload=function(){a.end=Date.now();a.done=!0;"function"===typeof c&&c.call(a,a.getStats())};b.onerror=function(){a.end=Date.now();a.error+=1;"function"===typeof c&&c.call(a,a.getStats())};b.send(JSON.stringify({p:a.payload}))};c.prototype.getStats=function(){var a={};a.time=this.end-this.start;a.errors=0<this.errors;a.close=0<this.close;a.done=this.done;return a};a.push(function(a){var j=b(1),h=b(1024),
g=b(524288);e.outbandwidth={};d.progress("Testing Websocket upload with small payload");(new c(j)).run(function(b){e.outbandwidth.small=b;d.progress("Testing Websocket upload with medium payload");(new c(h)).run(function(b){e.outbandwidth.medium=b;d.progress("Testing Websocket upload with large payload");(new c(g)).run(function(b){e.outbandwidth.large=b;"function"===typeof a&&a.call(null,e)})})})});a.push(function(a){e.inbandwidth={};d.progress("Testing Websocket download with small payload");(new c("payload-request?p=1")).run(function(b){e.inbandwidth.small=
b;d.progress("Testing Websocket download with medium payload");(new c("payload-request?p=1024")).run(function(b){e.inbandwidth.medium=b;d.progress("Testing Websocket download with large payload");(new c("payload-request?p=524288")).run(function(b){e.inbandwidth.large=b;"function"===typeof a&&a.call(null,e)})})})});a.push(function(a){var g=b(1),h=b(1024),f=b(524288);e.xhroutbandwidth={};d.progress("Testing XHR upload with small payload");(new c(g)).runXHR(function(b){e.xhroutbandwidth.small=b;d.progress("Testing XHR upload with medium payload");
(new c(h)).runXHR(function(b){e.xhroutbandwidth.medium=b;d.progress("Testing XHR upload with large payload");(new c(f)).runXHR(function(b){e.xhroutbandwidth.large=b;"function"===typeof a&&a.call(null,e)})})})});a.push(function(b){e.xhrinbandwidth={};d.progress("Testing XHR download with small payload");(new c("1")).runXHR(function(a){e.xhrinbandwidth.small=a;d.progress("Testing XHR download with medium payload");(new c("1024")).runXHR(function(a){e.xhrinbandwidth.medium=a;d.progress("Testing XHR download with large payload");
(new c("524288")).runXHR(function(a){e.xhrinbandwidth.large=a;"function"===typeof b&&b.call(null,e)})})})});return{run:function(b){var c=function(){var e=a.shift();e?e(c):"function"===typeof b&&b.call(null,d.TestSuite.getResults())};c()},getResults:function(){e.browser={string:d.BrowserDetect.browser+"-"+d.BrowserDetect.version+"-"+d.BrowserDetect.OS,browser:d.BrowserDetect.browser,version:d.BrowserDetect.version,os:d.BrowserDetect.OS};return e}}}();d.attachEventHandlers=function(){g(".create-test").addEventListener("click",
function(a){a.preventDefault();a=new XMLHttpRequest;a.open("GET","/test/new");a.addEventListener("readystatechange",function(){if(4===this.readyState){var b=JSON.parse(this.responseText);d.Templater.use("test",{TEST_ID:b.id||"",TEST_URL:b.url||""},d.attachEventHandlers)}});a.send(null)},!0);g(".run-test").addEventListener("click",function(a){a.preventDefault();var b=this.dataset.test;d.Templater.use("runner",{TEST_ID:b},d.attachEventHandlers);d.TestSuite.run(function(a){var e=g(".see-test-results");
g(".loader").style.visibility="hidden";d.progress("DONE!");e.dataset.results=JSON.stringify(a);var f=new XMLHttpRequest;f.open("POST","/test/"+b+"/save");f.setRequestHeader("Content-Type","application/json");f.addEventListener("readystatechange",function(){if(4===this.readyState){var a=JSON.parse(this.responseText);e.dataset.avg="OK"===a.status?JSON.stringify(a.avg):"unavailable";e.style.visibility="visible"}});f.send(JSON.stringify(a))})},!0);g(".see-test-results").addEventListener("click",function(a){a.preventDefault();
if(this.dataset&&this.dataset.results){d.Templater.use("result",d.attachEventHandlers);var a=JSON.parse(this.dataset.results),b="unavailable"===this.dataset.avg?!1:JSON.parse(this.dataset.avg),c=g("#raphael");Raphael(c,c.offsetWidth,c.offsetHeight).barchart(0,0,c.offsetWidth,c.offsetHeight,[[a.outbandwidth.small.time,a.outbandwidth.medium.time,a.outbandwidth.large.time],[b.outbandwidth.small.time,b.outbandwidth.medium.time,b.outbandwidth.large.time],[a.inbandwidth.small.time,a.inbandwidth.medium.time,
a.inbandwidth.large.time],[b.inbandwidth.small.time,b.inbandwidth.medium.time,b.inbandwidth.large.time],[a.xhroutbandwidth.small.time,a.xhroutbandwidth.medium.time,a.xhroutbandwidth.large.time],[b.xhroutbandwidth.small.time,b.xhroutbandwidth.medium.time,b.xhroutbandwidth.large.time],[a.xhrinbandwidth.small.time,a.xhrinbandwidth.medium.time,a.xhrinbandwidth.large.time],[b.xhrinbandwidth.small.time,b.xhrinbandwidth.medium.time,b.xhrinbandwidth.large.time]],{legendcolor:"#fff"}).label()}},!0)};f.addEventListener("load",
function(){d.BrowserDetect.init();d.Controller.subscribe(/\/$/,function(){d.Templater.use("home",d.attachEventHandlers)});d.Controller.subscribe(/\/test\/(test-\d+-\d+)$/,function(a,b){d.Templater.use("test",{TEST_ID:b[0],TEST_URL:f.location},d.attachEventHandlers)});d.Controller.subscribe(/\/404/,function(){d.Templater.use("not-found",d.attachEventHandlers)},!0);d.Controller.open(f.location.pathname)})})(window);
